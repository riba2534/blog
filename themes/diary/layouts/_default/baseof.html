<!DOCTYPE html>
<html>
    {{- partial "head.html" . -}}
    <body>
        <a class="skip-link" href="#main-content">跳到主要内容</a>
    	<div id="app">
            {{- partial "mobile-header.html" . -}}
            <!-- mobile header -->
            <div id="content">
                <div id="streamContainer" class="stream-container" role="main">
                    <div id="main-content"></div>
                    {{- block "main" . }}{{- end }}
                    </div>
            </div>

            {{- partial "sidebar.html" . -}}
            {{- partial "extrabar.html" . -}}

            {{- partial "mobile-footer.html" . -}}
            <!-- mobile footer -->
            </div>
    {{ partial "journal.html" .}}
    <!-- For compatibility. View https://github.com/AmazingRise/hugo-theme-diary/pull/135 for details.-->
    {{- $hugoVersion := split (replaceRE ".*([0-9]+)\\.([0-9]+)\\.([0-9]+).*" "$1 $2 $3" hugo.Version) " " -}}
    {{- if and (eq (int (index $hugoVersion 0)) 0) (ge (int (index $hugoVersion 1)) 101) -}}
        {{- /* no leading slash */ -}}
        <script src="{{"js/journal.js" | relURL}}"></script>
        <script src="{{"js/code-enhance.js" | relURL}}"></script>
    {{- else -}}
        {{- /* with leading slash */ -}}
        <script src="{{"/js/journal.js" | relURL}}"></script>
        <script src="{{"/js/code-enhance.js" | relURL}}"></script>
        <script src="{{"/js/liquid-glass.js" | relURL}}"></script>
    {{- end -}}

    <script>
    // Native JavaScript implementation for theme functionality
    (function() {
        window.themeState = {
            isDrawerOpen: false,
            sidebarSubMenuHidden: true,
            drawerSubMenuHidden: true,
            scrollY: 0,
            navOpacity: 0
        };

        const drawerEl = document.getElementById('drawer');
        const pageHeadEl = document.getElementById('pageHead');
        const overlayEl = document.getElementById('drawer-overlay');

        // Force remove any drawer mask elements but keep our transparent overlay
        function removeMasks() {
            const masks = document.querySelectorAll('#drawer-mask, .single-column-drawer-mask, [class*="mask"]:not(.single-column-drawer-overlay), [id*="mask"]:not(#drawer-overlay)');
            masks.forEach(mask => mask.remove());
        }
        removeMasks();
        // Check again after a delay
        setTimeout(removeMasks, 100);

        // Scroll handling for navbar opacity and title translation
        function handleScroll() {
            window.themeState.scrollY = window.scrollY;
            window.themeState.navOpacity = Math.min(window.scrollY / 300, 1);
            
            if (pageHeadEl) {
                pageHeadEl.style.transform = `translateZ(0px) translateY(${0.3 * window.themeState.scrollY}px)`;
                pageHeadEl.style.opacity = 1 - window.themeState.navOpacity;
            }
        }
        
        window.addEventListener('scroll', handleScroll);
        // Initial call
        handleScroll();

        window.toggleDrawer = function() {
            const state = window.themeState;
            state.isDrawerOpen = !state.isDrawerOpen;

            if (!drawerEl) {
                return;
            }

            if (state.isDrawerOpen) {
                drawerEl.classList.add('single-column-drawer-container-active');
                document.documentElement.style.overflow = 'hidden';
                if (overlayEl) {
                    overlayEl.style.display = 'block';
                    // Trigger reflow
                    overlayEl.offsetHeight; 
                }
            } else {
                drawerEl.classList.remove('single-column-drawer-container-active');
                document.documentElement.style.overflow = '';
                if (overlayEl) {
                    overlayEl.style.display = 'none';
                }
                state.drawerSubMenuHidden = true;
                // Hide all submenu items
                document.querySelectorAll('.drawer-submenu').forEach(el => {
                    el.style.display = 'none';
                });
            }
        };

        window.toggleSidebarSubMenu = function() {
            const state = window.themeState;
            state.sidebarSubMenuHidden = !state.sidebarSubMenuHidden;
            document.querySelectorAll('.sidebar-submenu').forEach(el => {
                el.style.display = state.sidebarSubMenuHidden ? 'none' : 'block';
            });
        };

        window.toggleDrawerSubMenu = function() {
            const state = window.themeState;
            state.drawerSubMenuHidden = !state.drawerSubMenuHidden;
            document.querySelectorAll('.drawer-submenu').forEach(el => {
                el.style.display = state.drawerSubMenuHidden ? 'none' : 'block';
            });
        };
    })();
    </script>

    </body>
</html>
